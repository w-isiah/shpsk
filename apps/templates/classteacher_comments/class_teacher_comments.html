{% extends "layouts/base.html" %}

{% block title %}Class Teacher Comments{% endblock %}

{% block body_class %}hold-transition sidebar-mini{% endblock %}

{% block stylesheets %}
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,400i,700&display=fallback">
<link rel="stylesheet" href="/static/assets/plugins/fontawesome-free/css/all.min.css">
<link rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
<link rel="stylesheet" href="/static/assets/css/adminlte.min.css">
<link rel="stylesheet" href="https://cdn.datatables.net/1.13.7/css/jquery.dataTables.min.css">
<link rel="stylesheet" href="https://cdn.datatables.net/responsive/2.3.0/css/responsive.dataTables.min.css">
<style>
  .alert-container {
    position: fixed;
    top: 20px;
    left: 50%;
    transform: translateX(-50%);
    z-index: 1050; /* Bootstrap modals use 1050, so keep alerts above */
    width: 80%;
    display: none;
  }
</style>
{% endblock stylesheets %}

{% block content %}
<div class="content-wrapper">
  <!-- Content Header (Page header) -->
  <section class="content-header">
    <div class="container-fluid">
      <div class="row mb-2 align-items-center">
        <div class="col-sm-6">
          <h1>Class Teacher Comments</h1>
        </div>
        <div class="col-sm-6 text-right">
          <a href="{{ url_for('classteacher_comments_blueprint.add_classteacher_comments') }}" class="btn btn-success">
            <i class="fas fa-plus-circle mr-1"></i> Add Comment
          </a>
        </div>
      </div>
    </div>
  </section>

  <!-- Main content -->
  <section class="content">

    {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
    <div class="alert-container" id="flashMessageContainer">
      {% for category, message in messages %}
      <div class="alert alert-{{ category }} alert-dismissible fade show" role="alert">
        <i class="fas fa-{{
          'check-circle' if category == 'success'
          else 'exclamation-circle' if category == 'warning'
          else 'times-circle' if category == 'danger'
          else 'info-circle' }}"></i>
          {{ message }}
          <button type="button" class="close" data-dismiss="alert" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        {% endfor %}
      </div>
      {% endif %}
      {% endwith %}

      <div class="container-fluid">
        <div class="card">
          <div class="card-header">
            <h3 class="card-title">Comments Table</h3>
          </div>
          <div class="card-body table-responsive p-0">
            <table id="classteacherCommentsTable" class="table table-striped table-bordered table-hover dt-responsive nowrap" style="width:100%">
              <thead>
                <tr>
                  <th>Teacher</th>
                  <th>Stream</th>
                  <th>Min Score</th>
                  <th>Max Score</th>
                  <th>Comment</th>
                  <th>Created At</th>
                  <th>Updated At</th>
                  <th>Edit</th>
                  <th>Delete</th>
                </tr>
              </thead>
              <tbody>
                {% for comment in classteacher_comments %}
                

                <tr>
                  <td>{{ comment.teacher_name or 'N/A' }}</td>        <!-- 1 -->
                  <td>{{ comment.stream_name or 'All Streams' }}</td> <!-- 2 -->
                  <td>{{ comment.min_score }}</td>                     <!-- 3 -->
                  <td>{{ comment.max_score }}</td>                     <!-- 4 -->
                  <td style="white-space: normal;">{{ comment.comment }}</td> <!-- 5 -->
                  <td>{{ comment.created_at.strftime('%Y-%m-%d %H:%M') if comment.created_at else '—' }}</td> <!-- 6 -->
                  <td>{{ comment.updated_at.strftime('%Y-%m-%d %H:%M') if comment.updated_at else '—' }}</td> <!-- 7 -->
                  <td>
                    <a href="{{ url_for('classteacher_comments_blueprint.edit_classteacher_comments', comment_id=comment.comment_id) }}" class="btn btn-sm btn-warning" title="Edit">
                      <i class="fas fa-edit"></i>
                    </a>
                  </td> <!-- 8 -->
                  <td>
                    {% if session['role'] == 'super_admin' %}
                    <a href="{{ url_for('classteacher_comments_blueprint.delete_classteacher_comments', comment_id=comment.comment_id) }}" 
                    class="btn btn-sm btn-danger" 
                    onclick="return confirm('Are you sure you want to delete this comment?')" 
                    title="Delete">
                    <i class="fas fa-trash-alt"></i>
                  </a>
                  {% else %}
                  <span>—</span>
                  {% endif %}
                </td> <!-- 9 -->
              </tr>



              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </section>
</div>
{% endblock content %}

{% block javascripts %}
<script src="/static/assets/plugins/jquery/jquery.min.js"></script>
<script src="/static/assets/plugins/bootstrap/js/bootstrap.bundle.min.js"></script>
<script src="/static/assets/js/adminlte.min.js"></script>
<script src="https://cdn.datatables.net/1.13.7/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/responsive/2.3.0/js/dataTables.responsive.min.js"></script>

<script>
  $(function () {
    $('#classteacherCommentsTable').DataTable({
      paging: true,
      searching: true,
      ordering: true,
      responsive: true,
      columnDefs: [
      { orderable: false, targets: [4, 7, 8] }
      ]
    });

    $('#flashMessageContainer').fadeIn(500).delay(3500).fadeOut(1000);
  });
</script>
{% endblock javascripts %}
