{% extends "layouts/base.html" %}

{% block title %} Register New Fixed Asset {% endblock %}

{% block body_class %} sidebar-mini layout-footer-fixed {% endblock body_class %}

{% block stylesheets %}
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,400i,700&display=fallback">
<link rel="stylesheet" href="/static/assets/plugins/fontawesome-free/css/all.min.css">
<link rel="stylesheet" href="/static/assets/css/adminlte.min.css">
<link rel="stylesheet" href="/static/assets/css/select2.min.css"> <style>
    .alert-container {
      position: fixed;
      top: 20px;
      left: 50%;
      transform: translateX(-50%);
      z-index: 9999;
      width: 80%;
      display: none;
    }

    .alert {
      opacity: 1;
      transition: opacity 1s ease-out;
      margin-bottom: 10px;
    }

    .alert.alert-dismissible {
      padding-right: 30px;
    }
    /* Style for required asterisk */
    .required-label::after {
        content: " *";
        color: red;
    }
</style>
{% endblock stylesheets %}

{% block content %}
<div class="content-wrapper">

    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
      <div class="alert-container" id="flashMessageContainer">
        {% for category, message in messages %}
        <div class="alert alert-{{ category }} alert-dismissible fade show" role="alert">
          <strong>{{ message }}</strong>
          <button type="button" class="close" data-dismiss="alert" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        {% endfor %}
      </div>
      {% endif %}
    {% endwith %}

    <section class="content-header">
      <div class="container-fluid">
        <div class="row mb-2">
          <div class="col-sm-6">
            <h1>Register New Fixed Asset</h1>
          </div>
          <div class="col-sm-6">
            <ol class="breadcrumb float-sm-right">
              <li class="breadcrumb-item"><a href="/index">Home</a></li>
              <li class="breadcrumb-item"><a href="/assets">Assets Register</a></li>
              <li class="breadcrumb-item active">Add Asset</li>
            </ol>
          </div>
        </div>
      </div>
    </section>

    <section class="content">
      <div class="container-fluid">
        <div class="row">
          <div class="col-md-8 offset-md-2 col-12">
            <div class="card card-primary"> <div class="card-header d-flex justify-content-between align-items-center">
                <h3 class="card-title mb-0">Asset Details</h3>
                <div class="btn-group ms-auto" role="group">
                  <a href="/assets" class="btn btn-warning btn-sm">Asset List</a>
                  <a href="/inventory_index" class="btn btn-success btn-sm">Inventory Dashboard</a>
                </div>
              </div>

              <form action="{{ url_for('fixed_assets_blueprint.add_asset') }}" method="post">
                <input type="hidden" name="_csrf_token" value="{{ csrf_token() }}">

                <div class="card-body">
                  <div class="row">
                    <div class="col-md-6">
                        <h5 class="text-primary mb-3"><i class="fas fa-barcode"></i> Identification</h5>

                        <div class="form-group mb-3">
                            <label class="control-label required-label" for="id-number">Identification Number:</label>
                            <input type="text" id="id-number" name="id_number" placeholder="e.g., ENG-001"
                                class="form-control form-control-sm border-info shadow-sm" required />
                        </div>

                        <div class="form-group mb-3">
                            <label class="control-label" for="serial-number">Serial Number:</label>
                            <input type="text" id="serial-number" name="serial_number" placeholder="Manufacturer Serial Number (Optional)"
                                class="form-control form-control-sm border-info shadow-sm" />
                        </div>
                        
                        <div class="form-group mb-3">
                            <label class="control-label required-label" for="description">Asset Description:</label>
                            <textarea id="description" name="description" placeholder="Full description of the asset (e.g., HP ProBook G7 Laptop)"
                                class="form-control form-control-sm border-info shadow-sm" required rows="2"></textarea>
                        </div>
                        
                        <h5 class="text-primary mb-3 mt-4"><i class="fas fa-money-bill-wave"></i> Acquisition & Cost</h5>
                        
                        <div class="form-group mb-3">
                            <label class="control-label required-label" for="acquisition-date">Acquisition Date:</label>
                            <input type="date" id="acquisition-date" name="acquisition_date"
                                class="form-control form-control-sm border-info shadow-sm" required />
                        </div>

                        <div class="form-group mb-3">
                            <label class="control-label required-label" for="cost-valuation">Cost/Valuation:</label>
                            <input type="number" step="0.01" id="cost-valuation" name="cost_valuation" placeholder="e.g., 1500.00"
                                class="form-control form-control-sm border-info shadow-sm" required />
                        </div>
                        
                    </div>

                    <div class="col-md-6">
                        <h5 class="text-info mb-3"><i class="fas fa-sitemap"></i> Categorization</h5>
                        
                        <div class="form-group mb-3">
                            <label class="control-label required-label" for="category-id">Category:</label>
                            <select id="category-id" name="category_id" class="form-control form-control-sm select2-simple border-info shadow-sm" required>
                                <option value="">Select Category...</option>
                                {% for category in categories %}
                                    <option value="{{ category.CategoryID }}">{{ category.Name }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        
                        <div class="form-group mb-3">
                            <label class="control-label required-label" for="location-id">Current Location:</label>
                            <select id="location-id" name="location_id" class="form-control form-control-sm select2-simple border-info shadow-sm" required>
                                <option value="">Select Location...</option>
                                {% for location in locations %}
                                    <option value="{{ location.LocationID }}">{{ location.LocationName }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        
                        <div class="form-group mb-3">
                            <label class="control-label" for="custodian-id">Custodian/Responsible Staff:</label>
                            <select id="custodian-id" name="custodian_id" class="form-control form-control-sm select2-simple border-info shadow-sm">
                                <option value="">Select Staff...</option>
                                {% for user in users %}
                                    <option value="{{ user.id }}">{{ user.last_name }}, {{ user.first_name }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        
                        <div class="form-group mb-3">
                            <label class="control-label" for="supplier-id">Supplier/Donor:</label>
                            <select id="supplier-id" name="supplier_id" class="form-control form-control-sm select2-simple border-info shadow-sm">
                                <option value="">Select Supplier/Donor...</option>
                                {% for supplier in suppliers %}
                                    <option value="{{ supplier.SupplierID }}">{{ supplier.Name }}</option>
                                {% endfor %}
                            </select>
                        </div>

                        <h5 class="text-danger mb-3 mt-4"><i class="fas fa-info-circle"></i> Status</h5>
                        
                        <div class="form-group mb-3">
                            <label class="control-label" for="ownership-status">Ownership Status:</label>
                            <select id="ownership-status" name="ownership_status" class="form-control form-control-sm border-info shadow-sm">
                                <option value="Owned" selected>Owned by Organization</option>
                                <option value="Leased">Leased</option>
                                <option value="Trust">Held in Trust</option>
                            </select>
                        </div>
                        
                        <div class="form-group mb-3">
                            <label class="control-label" for="asset-condition">Asset Condition:</label>
                            <select id="asset-condition" name="asset_condition" class="form-control form-control-sm border-info shadow-sm">
                                <option value="Good" selected>Good</option>
                                <option value="Fair">Fair</option>
                                <option value="Poor">Poor (Needs Repair)</option>
                                <option value="Missing">Missing</option>
                            </select>
                        </div>
                        
                    </div>
                  </div>
                </div> 
                
                <div class="card-footer">
                  <button type="submit" class="btn btn-sm btn-primary">
                      <i class="fas fa-save"></i> Register Asset
                  </button>
                  <a href="{{ url_for('fixed_assets_blueprint.assets') }}" class="btn btn-sm btn-secondary float-right">Cancel</a>
                </div>
              </form>
            </div>
          </div>
        </div>
      </div>
    </section>
</div>

{% endblock content %}

{% block javascripts %}
<script src="/static/assets/plugins/jquery/jquery.min.js"></script>
<script src="/static/assets/plugins/bootstrap/js/bootstrap.bundle.min.js"></script>
<script src="/static/assets/js/adminlte.min.js"></script>
<script src="/static/assets/js/demo.js"></script>
<script src="https://cdn.jsdelivr.net/npm/select2@4.0.13/dist/js/select2.min.js"></script> <script>
    $(document).ready(function() {
        // Initialize Select2 on all necessary dropdowns
        $('.select2-simple').select2({
            theme: 'bootstrap4',
            width: '100%',
            placeholder: $(this).attr('placeholder') || 'Select an option'
        });

        // Flash message fade-in and fade-out effect
        if ($('#flashMessageContainer').length) {
            $('#flashMessageContainer').fadeIn(500).delay(3000).fadeOut(1000);
        }
    });
</script>
{% endblock javascripts %}